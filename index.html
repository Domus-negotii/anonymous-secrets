<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whispers Online</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animation for fading in new secrets */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-purple-900 dark:to-indigo-900 text-gray-900 dark:text-gray-100 font-sans p-4 flex flex-col items-center min-h-screen">

    <div class="w-full max-w-2xl mx-auto my-8 p-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/20 dark:border-gray-700/20">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold mb-2 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">
                Whispers Online
            </h1>
            <p class="text-gray-600 dark:text-gray-400 text-lg">Share your secret anonymously and see how others react.</p>
            <div id="whisper-count" class="mt-2 text-sm text-gray-500 dark:text-gray-500">
                ✨ 0 whispers shared so far
            </div>
        </div>

        <!-- Confession Form -->
        <form id="confess-form" class="mb-8">
            <div class="relative">
                <textarea
                    id="secret-input"
                    class="w-full p-4 rounded-xl border-2 border-gray-200 dark:border-gray-600 bg-white/50 dark:bg-gray-700/50 backdrop-blur-sm text-base text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200 resize-none placeholder-gray-500 dark:placeholder-gray-400"
                    placeholder="What's weighing on your heart? Share it anonymously..."
                    rows="4"
                    required
                    maxLength="500"
                ></textarea>
                <div id="char-counter" class="absolute bottom-2 right-2 text-xs text-gray-400">
                    0/500
                </div>
            </div>
            <button
                id="confess-button"
                type="submit"
                class="w-full mt-4 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-xl hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-[1.02] active:scale-[0.98]"
            >
                🤫 Confess Anonymously
            </button>
        </form>

        <!-- Ad Placeholder Section -->
        <div class="my-8 p-6 bg-gradient-to-r from-yellow-100 to-amber-100 dark:from-yellow-900/30 dark:to-amber-900/30 rounded-xl shadow-md border border-yellow-200 dark:border-yellow-600/30 text-center">
            <p class="text-sm text-yellow-700 dark:text-yellow-300 font-semibold mb-2">💡 Advertisement</p>
            <p class="text-xl font-bold text-yellow-900 dark:text-yellow-100 mb-1">Your Ad Could Be Here</p>
            <p class="text-sm text-yellow-700 dark:text-yellow-300">Reach people in their most vulnerable moments 📺</p>
        </div>

        <!-- Confessions Section -->
        <div class="mb-6">
            <h2 class="text-3xl font-bold mb-6 text-center bg-gradient-to-r from-gray-700 to-gray-900 dark:from-gray-200 dark:to-gray-400 bg-clip-text text-transparent">
                Recent Whispers
            </h2>
            
            <!-- This is where the secrets will be injected by JavaScript -->
            <div id="secrets-container" class="space-y-6">
                <!-- Initial secrets will be rendered here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="text-center text-gray-500 py-12 hidden">
              <div class="text-6xl mb-4">🤐</div>
              <p class="text-xl">No secrets yet.</p>
              <p class="text-sm mt-2">Be the first to share your whisper!</p>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-sm text-gray-500 dark:text-gray-400 pt-6 border-t border-gray-200 dark:border-gray-700">
            <p>💫 All whispers are anonymous and ephemeral</p>
            <p class="mt-1">Share your truth, find your peace</p>
        </div>
    </div>

    <script>
        // Define the data and DOM elements
        const emotions = [
            { emoji: '❤️', label: 'Love' },
            { emoji: '😂', label: 'Laugh' },
            { emoji: '😢', label: 'Sad' },
            { emoji: '🙏', label: 'Care' },
            { emoji: '😮', label: 'Surprise' },
        ];

        let secrets = [
            {
                id: '1',
                secret: "I still sleep with a stuffed animal and I'm 25 years old. It helps me feel safe and reminds me of simpler times.",
                reactions: { Love: 15, Laugh: 3, Sad: 2, Care: 8, Surprise: 1 },
                timestamp: Date.now() - 86400000 
            },
            {
                id: '2',
                secret: "I pretend to be busy at work but I actually finished all my tasks hours ago. I just don't want more work piled on me.",
                reactions: { Love: 5, Laugh: 12, Sad: 1, Care: 3, Surprise: 7 },
                timestamp: Date.now() - 43200000 
            },
            {
                id: '3',
                secret: "I've been learning my grandmother's native language in secret because I want to surprise her on her 90th birthday next month.",
                reactions: { Love: 23, Laugh: 0, Sad: 0, Care: 18, Surprise: 4 },
                timestamp: Date.now() - 21600000 
            }
        ];

        const confessForm = document.getElementById('confess-form');
        const secretInput = document.getElementById('secret-input');
        const confessButton = document.getElementById('confess-button');
        const secretsContainer = document.getElementById('secrets-container');
        const whisperCountElement = document.getElementById('whisper-count');
        const emptyStateElement = document.getElementById('empty-state');
        const charCounterElement = document.getElementById('char-counter');

        // Function to format the timestamp
        const formatTime = (timestamp) => {
            const now = Date.now();
            const diff = now - timestamp;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            return `${Math.floor(diff / 86400000)}d ago`;
        };

        // Function to render all secrets to the page
        const renderSecrets = () => {
            secretsContainer.innerHTML = ''; // Clear existing secrets
            const sortedSecrets = [...secrets].sort((a, b) => b.timestamp - a.timestamp);
            
            whisperCountElement.textContent = `✨ ${sortedSecrets.length} whispers shared so far`;

            if (sortedSecrets.length === 0) {
              emptyStateElement.style.display = 'block';
            } else {
              emptyStateElement.style.display = 'none';
              sortedSecrets.forEach((secret, index) => {
                  const secretElement = document.createElement('div');
                  secretElement.className = "group p-6 bg-white/60 dark:bg-gray-700/60 backdrop-blur-sm rounded-xl shadow-lg border border-white/30 dark:border-gray-600/30 hover:shadow-xl transition-all duration-300 hover:scale-[1.01]";
                  secretElement.style.animationDelay = `${index * 0.1}s`;
                  secretElement.style.animation = 'fadeIn 0.5s ease-out forwards';
                  secretElement.dataset.secretId = secret.id;

                  let reactionButtonsHtml = emotions.map(emotion => {
                      const count = secret.reactions[emotion.label] || 0;
                      return `
                          <button
                              type="button"
                              data-emotion-label="${emotion.label}"
                              class="flex items-center px-3 py-2 rounded-full border border-gray-200 dark:border-gray-600 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm text-sm font-medium hover:bg-white dark:hover:bg-gray-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 shadow-sm hover:shadow-md transform hover:scale-105 active:scale-95"
                              title="React with ${emotion.label}"
                          >
                              <span class="text-lg mr-2">${emotion.emoji}</span>
                              <span class="text-gray-600 dark:text-gray-400 font-bold min-w-[20px] text-center">
                                  ${count}
                              </span>
                          </button>
                      `;
                  }).join('');

                  const totalReactions = Object.values(secret.reactions).reduce((a, b) => a + b, 0);

                  secretElement.innerHTML = `
                      <div class="flex justify-between items-start mb-4">
                          <p class="text-lg text-gray-800 dark:text-gray-200 leading-relaxed flex-1 mr-4">
                              "${secret.secret}"
                          </p>
                          <span class="text-xs text-gray-400 whitespace-nowrap">
                              ${formatTime(secret.timestamp)}
                          </span>
                      </div>
                      <div class="flex flex-wrap gap-2 justify-center">
                          ${reactionButtonsHtml}
                      </div>
                      <div class="mt-3 text-center">
                          <span class="text-xs text-gray-400">
                              ${totalReactions} total reactions
                          </span>
                      </div>
                  `;
                  secretsContainer.appendChild(secretElement);
              });
            }
        };

        // Handle form submission for a new secret
        const handleConfess = (e) => {
            e.preventDefault(); // Prevent page refresh
            
            const newSecretText = secretInput.value.trim();
            if (newSecretText === '') return;

            confessButton.disabled = true;
            confessButton.innerHTML = `<div class="flex items-center justify-center">
                <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>
                Sharing...
            </div>`;

            // Simulate network delay
            setTimeout(() => {
                const newSecretObj = {
                    id: Date.now().toString(),
                    secret: newSecretText,
                    reactions: emotions.reduce((acc, emotion) => ({ ...acc, [emotion.label]: 0 }), {}),
                    timestamp: Date.now(),
                };
                
                secrets.unshift(newSecretObj); // Add to the beginning of the array
                secretInput.value = ''; // Clear the input field
                renderSecrets(); // Re-render the secrets list
                
                confessButton.disabled = false;
                confessButton.innerHTML = `🤫 Confess Anonymously`;
                charCounterElement.textContent = '0/500';
            }, 500);
        };

        // Handle a user clicking an emotion button
        const handleReaction = (e) => {
            const button = e.target.closest('[data-emotion-label]');
            if (!button) return;

            const emotionLabel = button.dataset.emotionLabel;
            const secretCard = button.closest('[data-secret-id]');
            const secretId = secretCard.dataset.secretId;

            secrets = secrets.map(secret =>
                secret.id === secretId
                    ? {
                        ...secret,
                        reactions: {
                            ...secret.reactions,
                            [emotionLabel]: (secret.reactions[emotionLabel] || 0) + 1
                        }
                    }
                    : secret
            );
            renderSecrets();
        };

        // Event Listeners
        window.addEventListener('load', renderSecrets);
        confessForm.addEventListener('submit', handleConfess);
        secretsContainer.addEventListener('click', handleReaction);
        secretInput.addEventListener('input', (e) => {
          charCounterElement.textContent = `${e.target.value.length}/500`;
        });
    </script>
</body>
</html>
